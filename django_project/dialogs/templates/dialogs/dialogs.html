{% extends "base/base.html" %}
{% load crispy_forms_tags %}
{% block content %}


<div class="row">
    <div class="col-md-4">
        <div class="all-dialogs">
            {% for chat, receiver in list %}
            <div class="get-dialog" onclick="location.href='{% url 'dialog-view' chat.id %}'">
                <img class="rounded-circle dialog-img " src="{{ receiver.profile.image.url }}">
                <div class="get-dialog-no-img">
                    <div class="message-receiver-and-date">
                        <div class="message-receiver">
                            {{ receiver.username }}
                        </div>
                        <div class="message-date">
                            {{ chat.last_message_send_date }}
                        </div>
                    </div>
                    <div class="message-content">
                        {{ chat.last_message }}
                    </div>
                </div>
            </div>
            <hr class="hr-1" align="right" size="1"/>
            {% endfor %}
        </div>
    </div>
    <div class="col-md-8">
        {% if chat %}
        <div class="content-section content-section-flex">
            <div class="receiver">
                <img class="rounded-circle article-img sender-img" src="{{ receiver.profile.image.url }}">
                <div class="receiver-username">
                    {{ receiver.username }}
                </div>
            </div>
        </div>
        {% endif %}

        {% if chat %}
        <div class="content-section content-section-flex overflow" id="block">
            {% for message in chat.messages.all %}
            <div class="message">
                <img class="rounded-circle article-img sender-img" src="{{ message.sender.profile.image.url }}">
                <div class="message-no-img">
                    <div class="message-sender-and-date">
                        <div class="message-sender">
                            <a class="message-sender-text" href="{% url 'profile' message.sender.id %}">{{ message.sender.username }}</a>
                        </div>
                        <div class="message-date-send">
                            {{ message.date_send }}
                        </div>
                    </div>
                    <div class="message-content">
                        {{ message.content }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <script type="text/javascript">
            var block = document.getElementById("block");
            block.scrollTop = block.scrollHeight;
        </script>

        {% else %}
        <div class="content-section linkBlock" onclick="location.href='#'">
            Нажми на пользователя, чтобы открыть чат
        </div>
        {% endif %}


        {% if chat %}
        <div class="content-section">
            <form action="{% url 'message-create' chat.id %}" method="post">
                {% csrf_token %}
                <fieldset class="form-group">
                    <!-- <legend class="border-bottom mb-4">Blog Post</legend>-->
                    {% for field in form %}
                    <div class="form-group">
                        {% if field.errors %}
                        <div class=".alert.alert-danger">
                            {{ field.errors }}
                        </div>
                        {% endif %}

                        {{ field.label }}
                        {{ field }}
                    </div>
                    {% endfor %}
                </fieldset>
                <div class="form-group">
                    <button class="btn btn-outline-info" type="submit">Отправить</button>
                </div>
            </form>
        </div>
        {% endif %}
    </div>
</div>


{% endblock content %}
